---
import BaseLayout from '../../../modules/core/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '../../../components/ui/card';
import { Badge } from '../../../components/ui/badge';
import { Separator } from '../../../components/ui/separator';

export async function getStaticPaths() {
   return [
    { params: { lang: 'en' } },
    { params: { lang: 'zh' } },
  ];
}

const { lang } = Astro.params;
const posts = await getCollection('blog', ({ data }) => data.lang === lang);
---

<BaseLayout title="Blog" lang={lang}>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-2">Blog</h1>
    <p class="text-gray-500 mb-6">Latest thoughts and updates.</p>
    <Separator className="mb-8" />
    
    <div class="grid gap-6">
      {posts.length > 0 ? (
        posts.map(post => (
          <Card key={post.slug}>
            <CardHeader>
              <CardTitle>
                <a href={`/${lang}/blog/${post.slug}/`} class="hover:underline decoration-primary">
                  {post.data.title}
                </a>
              </CardTitle>
              <CardDescription>
                {post.data.pubDate.toLocaleDateString(lang === 'en' ? 'en-US' : 'zh-CN')}
              </CardDescription>
            </CardHeader>
            <CardContent>
              <p>{post.data.description}</p>
            </CardContent>
            <CardFooter>
              <div class="flex gap-2">
                {post.data.tags.map(tag => (
                  <Badge variant="secondary">{tag}</Badge>
                ))}
              </div>
            </CardFooter>
          </Card>
        ))
      ) : (
        <p>No posts found.</p>
      )}
    </div>
  </div>
</BaseLayout>

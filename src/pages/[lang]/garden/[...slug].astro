---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../modules/core/layouts/BaseLayout.astro';
import { Timeline } from '../../../components/garden/Timeline'; // Optional: keep sidebar?

export async function getStaticPaths() {
  const posts = await getCollection('garden');
  return posts.map(post => {
      // Assuming slug doesn't include lang prefix? 
      // But collection entries usually don't have lang in slug unless folder structure.
      // My schema has 'lang' field.
      // I should map both 'en' and 'zh' paths?
      // Or filter? 
      // If I want /en/garden/slug, I need to match post.data.lang
      const lang = post.data.lang || 'en';
      return {
        params: { lang, slug: post.slug },
        props: { post },
      };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();
const { lang } = Astro.params;

// Fetch all posts for Timeline (optional context)
const allPosts = await getCollection('garden');
const timelineItems = allPosts
  .filter(p => p.data.lang === lang)
  .map(p => ({
    slug: p.slug,
    pubDate: p.data.pubDate,
    title: p.data.title
  }));
---

<BaseLayout title={post.data.title} description={post.data.description} lang={lang}>
  <div class="flex min-h-screen">
    <Timeline items={timelineItems} activeSlug={post.slug} />
    
    <main className="flex-1 lg:ml-24 p-4 md:p-8 max-w-4xl mx-auto pt-20">
      <div className="mb-8">
        <a href={`/${lang}/garden`} className="text-sm text-muted-foreground hover:text-primary mb-4 block">
          ‚Üê Back to Garden
        </a>
        <div className="flex items-center gap-2 mb-2">
            <span className="text-xs font-mono text-muted-foreground uppercase">{post.data.type}</span>
            <span className="text-xs text-muted-foreground">{post.data.pubDate.toLocaleDateString()}</span>
        </div>
        <h1 className="text-4xl font-bold mb-4">{post.data.title}</h1>
        {post.data.description && (
          <p className="text-xl text-muted-foreground">{post.data.description}</p>
        )}
      </div>

      <div className="prose dark:prose-invert max-w-none">
        <Content />
      </div>
    </main>
  </div>
</BaseLayout>
